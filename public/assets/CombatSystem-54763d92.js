import{r as c,j as a}from"./index-b7fc291e.js";import{C as E}from"./CharacterCard-20af0b8d.js";import{a as d}from"./api-798963ee.js";import"./translations-214f6220.js";const z=()=>{const[m,u]=c.useState([]),[S,x]=c.useState(!0),[j,l]=c.useState(""),[r,p]=c.useState(null),[n,f]=c.useState(null),[g,v]=c.useState([]),[k,o]=c.useState(!1);c.useEffect(()=>{b()},[]);const b=async()=>{try{x(!0);const s=await d.getCharacters();u(s),l("")}catch(s){l(s instanceof Error?s.message:"Error al cargar los personajes")}finally{x(!1)}},C=async s=>{try{const e=await d.getCharacter(s);u(t=>t.map(i=>i.id===s?e:i))}catch(e){console.error("Failed to refresh character:",e)}},h=s=>{const e=new Date().toLocaleTimeString();v(t=>[`[${e}] ${s}`,...t.slice(0,9)])},A=async s=>{if(r){o(!0);try{const e=await d.performAttack(r.id,s);f(e);const t=m.find(R=>R.id===s),i=r.name,N=(t==null?void 0:t.name)||"Unknown";e.success?h(`${i} attacks ${N}! Roll: ${e.attackRoll} vs AC ${e.targetAc}. ${e.criticalHit?"CRITICAL HIT! ":""}Damage: ${e.damage}`):h(`${i} attacks ${N} but misses! Roll: ${e.attackRoll} vs AC ${e.targetAc}`),await C(s)}catch(e){l(e instanceof Error?e.message:"Error en el ataque")}finally{o(!1)}}},$=async s=>{const e=parseInt(prompt("Ingresa la cantidad de curación:")||"0");if(!(e<=0)){o(!0);try{await d.healCharacter(s,e);const t=m.find(i=>i.id===s);h(`${(t==null?void 0:t.name)||"Personaje"} curado por ${e} HP!`),await C(s)}catch(t){l(t instanceof Error?t.message:"Error en la curación")}finally{o(!1)}}},w=async s=>{o(!0);try{const e=await d.rollInitiative(s),t=m.find(i=>i.id===s);h(`${(t==null?void 0:t.name)||"Personaje"} tira iniciativa: ${e.initiative}`)}catch(e){l(e instanceof Error?e.message:"Error en la tirada de iniciativa")}finally{o(!1)}},y=m.filter(s=>s.isAlive);return S?a.jsx("div",{className:"loading",children:"Cargando personajes..."}):j?a.jsxs("div",{className:"card",children:[a.jsx("div",{className:"error",children:j}),a.jsx("button",{className:"button",onClick:b,children:"Intentar de Nuevo"})]}):y.length===0?a.jsxs("div",{className:"card",children:[a.jsx("h2",{children:"No Hay Personajes Vivos"}),a.jsx("p",{children:"¡Todos los personajes están muertos! Crea nuevos personajes para comenzar el combate."})]}):a.jsxs("div",{children:[a.jsxs("div",{className:"card",children:[a.jsx("h2",{children:"⚔️ Sistema de Combate"}),a.jsx("p",{children:r?`${r.name} está listo para atacar! Selecciona un objetivo.`:"Selecciona un atacante para comenzar el combate."}),r&&a.jsx("div",{style:{marginTop:"15px"},children:a.jsx("button",{className:"button secondary",onClick:()=>{p(null),f(null)},children:"Limpiar Selección"})})]}),n&&a.jsxs("div",{className:"card",children:[a.jsx("h3",{children:"Resultado del Ataque"}),a.jsxs("div",{className:"attack-result",children:[a.jsxs("div",{className:"stat-row",children:[a.jsx("span",{children:"Tirada de Ataque:"}),a.jsx("span",{children:n.attackRoll})]}),a.jsxs("div",{className:"stat-row",children:[a.jsx("span",{children:"CA del Objetivo:"}),a.jsx("span",{children:n.targetAc})]}),a.jsxs("div",{className:"stat-row",children:[a.jsx("span",{children:"Impacto:"}),a.jsx("span",{style:{color:n.success?"#00b894":"#ff6b6b"},children:n.success?"SÍ":"NO"})]}),n.success&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"stat-row",children:[a.jsx("span",{children:"Daño:"}),a.jsx("span",{children:n.damage})]}),a.jsxs("div",{className:"stat-row",children:[a.jsx("span",{children:"Golpe Crítico:"}),a.jsx("span",{style:{color:n.criticalHit?"#ffd700":"#ffffff"},children:n.criticalHit?"SÍ":"NO"})]})]})]})]}),a.jsxs("div",{className:"card",children:[a.jsx("h3",{children:"Participantes del Combate"}),a.jsx("div",{className:"character-grid",children:y.map(s=>a.jsx(E,{character:s,showCombatActions:!0,onSelect:e=>{(r==null?void 0:r.id)===e.id?p(null):p(e)},onAttack:e=>{r&&r.id!==e&&A(e)},onHeal:$,onInitiative:w},s.id))}),r&&a.jsxs("div",{style:{marginTop:"20px",padding:"15px",background:"rgba(255, 255, 255, 0.1)",borderRadius:"8px"},children:[a.jsxs("strong",{children:["Atacante Seleccionado: ",r.name]}),a.jsx("p",{children:"Haz clic en otro personaje para atacarlo, o usa los botones de combate para otras acciones."})]})]}),g.length>0&&a.jsxs("div",{className:"card",children:[a.jsx("h3",{children:"Registro de Combate"}),a.jsx("div",{style:{background:"rgba(0, 0, 0, 0.3)",padding:"15px",borderRadius:"8px",fontFamily:"monospace",fontSize:"0.9rem",maxHeight:"300px",overflowY:"auto"},children:g.map((s,e)=>a.jsx("div",{style:{marginBottom:"5px"},children:s},e))}),a.jsx("button",{className:"button secondary",onClick:()=>v([]),style:{marginTop:"10px"},children:"Limpiar Registro"})]}),k&&a.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:a.jsx("div",{className:"card",children:a.jsx("div",{className:"loading",children:"Procesando acción..."})})})]})};export{z as CombatSystem};
