import{r as d,j as e,a as ee}from"./index-7eaf2622.js";const te="http://localhost:3000/api";class se{async fetch(S,x){const f=await fetch(`${te}${S}`,{headers:{"Content-Type":"application/json",...x==null?void 0:x.headers},...x});if(!f.ok){const u=await f.json().catch(()=>({error:"Network error"}));throw new Error(u.error||`HTTP ${f.status}`)}return f.json()}async getStories(){return this.fetch("/stories")}async getActiveStories(){return this.fetch("/stories/active")}async getStory(S){return this.fetch(`/stories/${S}`)}async getStoriesByCharacter(S){return this.fetch(`/stories/character/${S}`)}async createStory(S){return this.fetch("/stories",{method:"POST",body:JSON.stringify(S)})}async continueStory(S){return this.fetch(`/stories/${S.storyId}/continue`,{method:"POST",body:JSON.stringify({selectedOption:S.selectedOption,customAction:S.customAction})})}}const G=new se,re=({diceRequests:s,onRollComplete:S})=>{const[x,f]=d.useState([]),[u,k]=d.useState(!1),N=c=>{const l=c.match(/^(\d*)d(\d+)([+-]\d+)?$/i);if(!l)return{roll:1,modifier:0,total:1};const b=l[1]?parseInt(l[1]):1,w=parseInt(l[2]),i=l[3]?parseInt(l[3]):0;let g=0;for(let R=0;R<b;R++)g+=Math.floor(Math.random()*w)+1;const o=g+i;return{roll:g,modifier:i,total:o}},I=async()=>{k(!0);const c=[];for(const l of s){const b=N(l.diceNotation||"1d20"),w=l.difficulty?b.total>=l.difficulty:void 0;c.push({roll:b.roll,modifier:b.modifier,total:b.total,success:w,description:l.description}),await new Promise(i=>setTimeout(i,500))}f(c),k(!1),S(c)},A=c=>c.success===void 0?"#ffffff":c.success?"#00b894":"#ff6b6b",y=c=>c.success===void 0?"":c.success?"‚úÖ √âxito":"‚ùå Fallo";return e.jsxs("div",{className:"card",style:{marginBottom:"20px"},children:[e.jsx("h3",{children:"üé≤ Tiradas Requeridas"}),s.map((c,l)=>e.jsx("div",{style:{background:"rgba(255, 255, 255, 0.1)",padding:"15px",borderRadius:"8px",marginBottom:"10px",border:"1px solid rgba(255, 255, 255, 0.2)"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("strong",{children:c.description}),e.jsxs("div",{style:{fontSize:"0.9rem",opacity:.8},children:[c.diceNotation,c.difficulty&&` (DC ${c.difficulty})`]})]}),x[l]&&e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx("div",{style:{fontSize:"1.2rem",fontWeight:"bold",color:A(x[l])},children:x[l].total}),e.jsxs("div",{style:{fontSize:"0.8rem",opacity:.8},children:[x[l].roll,x[l].modifier?` ${x[l].modifier>=0?"+":""}${x[l].modifier}`:""]}),e.jsx("div",{style:{fontSize:"0.9rem",color:A(x[l]),fontWeight:"bold"},children:y(x[l])})]})]})},l)),x.length===0&&e.jsx("button",{className:"button",onClick:I,disabled:u,style:{marginTop:"15px"},children:u?"üé≤ Tirando dados...":"üé≤ Tirar Todos los Dados"})]})};const Q=({diceType:s,isRolling:S,finalValue:x,modifier:f=0,onRollComplete:u,advantage:k=!1,disadvantage:N=!1,count:I=1})=>{const[A,y]=d.useState([]),[c,l]=d.useState([]),[b,w]=d.useState([]),[i,g]=d.useState("idle"),o=d.useRef(null),R=k||N?2:I;d.useEffect(()=>{const a=[],j=[];for(let v=0;v<R;v++)a.push({x:v*120-(R-1)*60,y:0,rotationX:0,rotationY:0,rotationZ:0,scale:1}),j.push(1);y(a),l(j)},[R]),d.useEffect(()=>{S&&i==="idle"&&E()},[S,i]);const E=()=>{g("throwing"),setTimeout(()=>{g("rolling"),T()},500)},T=()=>{let a=0;const j=3e3;o.current=setInterval(()=>{a+=100,y(v=>v.map((M,m)=>({x:M.x+(Math.random()-.5)*20,y:Math.sin(a*.01+m)*30+Math.random()*10,rotationX:M.rotationX+(Math.random()*90+45),rotationY:M.rotationY+(Math.random()*90+45),rotationZ:M.rotationZ+(Math.random()*90+45),scale:.9+Math.random()*.2}))),l(v=>v.map(()=>Math.floor(Math.random()*s)+1)),a>=j&&(o.current&&clearInterval(o.current),g("settling"),B())},100)},B=()=>{let j=0;const v=[];for(let m=0;m<R;m++)x!==void 0&&R===1?v.push(x):v.push(Math.floor(Math.random()*s)+1);if(k&&v.length===2){const m=Math.max(...v);v.forEach((X,q)=>{v[q]!==m&&(v[q]=Math.floor(Math.random()*(m-1))+1)})}else if(N&&v.length===2){const m=Math.min(...v);v.forEach((X,q)=>{v[q]!==m&&(v[q]=Math.floor(Math.random()*(s-m))+m+1)})}w(v);const M=setInterval(()=>{j+=100;const m=j/1e3;if(y(X=>X.map((q,Z)=>({x:q.x*(1-m)+(Z*120-(R-1)*60)*m,y:q.y*(1-m),rotationX:q.rotationX+(Math.random()-.5)*10*(1-m),rotationY:q.rotationY+(Math.random()-.5)*10*(1-m),rotationZ:q.rotationZ+(Math.random()-.5)*10*(1-m),scale:q.scale*(1-m)+1*m}))),j>=1e3){clearInterval(M),g("complete"),l(v);const X=v.reduce((q,Z)=>q+Z,0);u==null||u(X+f)}},100)},F=a=>{switch(s){case 4:return t(a);case 6:return $(a);case 8:return n(a);case 10:return C(a);case 12:return D(a);case 20:return z(a);case 100:return V(a);default:return $(a)}},$=a=>e.jsxs("div",{className:"dice-cube",children:[e.jsx("div",{className:"face front",children:P(a)}),e.jsx("div",{className:"face back",children:P(7-a)}),e.jsx("div",{className:"face right",children:P(a%6+1)}),e.jsx("div",{className:"face left",children:P((a+1)%6+1)}),e.jsx("div",{className:"face top",children:P((a+2)%6+1)}),e.jsx("div",{className:"face bottom",children:P((a+3)%6+1)})]}),t=a=>e.jsxs("div",{className:"dice-tetrahedron",children:[e.jsx("div",{className:"face",children:a}),e.jsx("div",{className:"face",children:a%4+1}),e.jsx("div",{className:"face",children:(a+1)%4+1}),e.jsx("div",{className:"face",children:(a+2)%4+1})]}),n=a=>e.jsx("div",{className:"dice-octahedron",children:e.jsx("div",{className:"face",children:a})}),C=a=>e.jsx("div",{className:"dice-decahedron",children:e.jsx("div",{className:"face",children:a===10?"0":a})}),D=a=>e.jsx("div",{className:"dice-dodecahedron",children:e.jsx("div",{className:"face",children:a})}),z=a=>e.jsx("div",{className:"dice-icosahedron",children:e.jsx("div",{className:"face",children:a})}),V=a=>e.jsx("div",{className:"dice-percentile",children:e.jsx("div",{className:"face",children:a})}),P=a=>{const j=[],M={1:[4],2:[0,8],3:[0,4,8],4:[0,2,6,8],5:[0,2,4,6,8],6:[0,2,3,5,6,8]}[a]||[4];for(let m=0;m<9;m++)j.push(e.jsx("span",{className:`dot ${M.includes(m)?"active":""}`},m));return e.jsx("div",{className:"dot-pattern",children:j})},Y=()=>k?"#4ade80":N?"#ef4444":"#3b82f6",W=a=>{if(s===20){if(a===20)return"#fbbf24";if(a===1)return"#ef4444"}return"#f1f5f9"};return e.jsxs("div",{className:"realistic-dice-container",children:[e.jsxs("div",{className:"dice-table",children:[e.jsx("div",{className:"dice-area",children:A.map((a,j)=>e.jsxs("div",{className:`dice-wrapper ${i}`,style:{transform:`
                  translate3d(${a.x}px, ${a.y}px, 0)
                  rotateX(${a.rotationX}deg)
                  rotateY(${a.rotationY}deg)
                  rotateZ(${a.rotationZ}deg)
                  scale(${a.scale})
                `,color:Y(),transition:i==="settling"?"all 0.3s ease-out":"none"},children:[e.jsx("div",{className:"dice-3d",children:F(i==="complete"&&b[j]||c[j])}),i==="complete"&&e.jsxs("div",{className:"dice-result-overlay",children:[e.jsx("span",{className:"result-number",style:{color:W(b[j]||c[j])},children:b[j]||c[j]}),k&&j===0&&e.jsx("span",{className:"advantage-label",children:"VENTAJA"}),N&&j===0&&e.jsx("span",{className:"disadvantage-label",children:"DESVENTAJA"})]})]},j))}),i==="complete"&&e.jsxs("div",{className:"final-result",children:[e.jsx("div",{className:"total-calculation",children:b.length>1?e.jsxs("span",{children:[b.join(" + "),f!==0&&` ${f>=0?"+":""}${f}`," = "," ",e.jsx("strong",{children:b.reduce((a,j)=>a+j,0)+f})]}):e.jsxs("span",{children:[b[0],f!==0&&` ${f>=0?"+":""}${f}`," = "," ",e.jsx("strong",{children:b[0]+f})]})}),s===20&&b.some(a=>a===20)&&e.jsx("div",{className:"critical-success",children:"üåü ¬°√âXITO CR√çTICO! üåü"}),s===20&&b.some(a=>a===1)&&e.jsx("div",{className:"critical-failure",children:"üí• ¬°FALLO CR√çTICO! üí•"})]})]}),e.jsxs("div",{className:"dice-info",children:[e.jsxs("div",{className:"dice-type-label",children:[R>1?`${R}d${s}`:`d${s}`,f!==0&&` ${f>=0?"+":""}${f}`]}),i!=="idle"&&i!=="complete"&&e.jsx("div",{className:"rolling-indicator",children:e.jsx("span",{className:"rolling-dots",children:"üé≤ Rodando"})})]})]})},K=({roll:s,characterName:S,onNarrationComplete:x})=>{const[f,u]=d.useState(""),[k,N]=d.useState(!1);d.useEffect(()=>{const i=A(s,S);N(!0),I(i)},[s,S]);const I=i=>{u("");let g=0;const o=setInterval(()=>{g<i.length?(u(R=>R+i.charAt(g)),g++):(clearInterval(o),N(!1),setTimeout(()=>{x==null||x()},1e3))},30);return()=>clearInterval(o)},A=(i,g)=>{const{type:o,result:R,difficulty:E,success:T,criticalSuccess:B,criticalFailure:F,description:$}=i;let t=`üé≤ **${g}** `;switch(o){case"ability":t+=`realiza una tirada de ${y(i.ability||$)}`;break;case"skill":t+=`intenta usar ${c(i.skill||$)}`;break;case"saving_throw":t+=`hace una tirada de salvaci√≥n de ${y(i.ability||$)}`;break;case"attack":t+="ataca";break;case"damage":t+="causa da√±o";break}if(t+=`.

`,B)t+="üåü **¬°√âXITO CR√çTICO!** Sac√≥ un 20 natural! ",t+=l(o,!0);else if(F)t+="üí• **¬°FALLO CR√çTICO!** Sac√≥ un 1 natural! ",t+=b(o,!0);else if(t+=`Resultado: **${R}** vs DC ${E}

`,T){const n=R-E;n>=10?(t+="‚ú® **¬°GRAN √âXITO!** ",t+=l(o,!1,n)):n>=5?(t+="‚úÖ **¬°√âXITO!** ",t+=l(o,!1,n)):(t+="‚úÖ **√âxito por poco.** ",t+=l(o,!1,n))}else{const n=E-R;n>=10?(t+="‚ùå **FALLO TOTAL.** ",t+=b(o,!1,n)):(t+="‚ùå **Fallo.** ",t+=b(o,!1,n))}return t},y=i=>({strength:"Fuerza",dexterity:"Destreza",constitution:"Constituci√≥n",intelligence:"Inteligencia",wisdom:"Sabidur√≠a",charisma:"Carisma",perception:"Percepci√≥n",investigation:"Investigaci√≥n",persuasion:"Persuasi√≥n",stealth:"Sigilo",athletics:"Atletismo",acrobatics:"Acrobacias"})[i.toLowerCase()]||i,c=i=>y(i),l=(i,g,o)=>{switch(i){case"ability":case"skill":return g?"Su destreza y determinaci√≥n superan cualquier obst√°culo. Lo que parec√≠a imposible se convierte en un logro extraordinario.":o&&o>=10?"Ejecuta la acci√≥n con maestr√≠a absoluta, superando ampliamente las expectativas.":o&&o>=5?"Realiza la acci√≥n con competencia y confianza.":"Logra completar la acci√≥n exitosamente, aunque con cierto esfuerzo.";case"saving_throw":return g?"Su voluntad es inquebrantable. No solo resiste el efecto, sino que sale fortalecido de la experiencia.":o&&o>=10?"Resiste completamente el efecto sin el menor esfuerzo aparente.":"Logra resistir el efecto a trav√©s de su determinaci√≥n.";case"attack":return g?"¬°Un golpe perfecto! Encuentra el punto d√©bil exacto de su oponente.":o&&o>=10?"Un ataque certero que conecta limpiamente con su objetivo.":"Su ataque logra conectar con el objetivo.";default:return"¬°√âxito!"}},b=(i,g,o)=>{switch(i){case"ability":case"skill":return g?"Todo sale terriblemente mal. No solo falla, sino que las consecuencias pueden ser peores de lo esperado.":o&&o>=10?"La acci√≥n falla completamente, sin ning√∫n progreso hacia el objetivo.":"A pesar de su esfuerzo, no logra completar la acci√≥n satisfactoriamente.";case"saving_throw":return g?"Sucumbe completamente al efecto. Su resistencia se desploma en el peor momento posible.":o&&o>=10?"Es completamente superado por el efecto, sin poder ofrecer resistencia.":"No logra resistir el efecto y debe enfrentar las consecuencias.";case"attack":return g?"¬°Su arma se atasca, resbala o algo sale terriblemente mal! Puede haber consecuencias adicionales.":o&&o>=10?"El ataque falla por completo, sin acercarse siquiera al objetivo.":"Su ataque no logra conectar con el objetivo.";default:return"Fallo."}},w=()=>s.criticalSuccess?"#fbbf24":s.criticalFailure?"#ef4444":s.success?"#10b981":"#6b7280";return e.jsxs("div",{className:"dice-narrator",style:{padding:"16px",backgroundColor:"#1e293b",borderRadius:"8px",margin:"16px 0",border:`2px solid ${w()}`,boxShadow:`0 4px 12px ${w()}20`},children:[e.jsxs("div",{className:"narrator-header",style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"12px",color:w(),fontWeight:"bold"},children:[e.jsx("span",{children:"üé≠"}),e.jsx("span",{children:"Dungeon Master"})]}),e.jsxs("div",{className:"narrator-text",style:{color:"#f1f5f9",lineHeight:1.6,fontSize:"14px",whiteSpace:"pre-line"},children:[f,k&&e.jsx("span",{className:"cursor",style:{animation:"blink 1s infinite"},children:"|"})]}),e.jsxs("div",{className:"roll-summary",style:{marginTop:"12px",padding:"8px",backgroundColor:"#334155",borderRadius:"4px",fontSize:"12px",color:"#94a3b8",display:"flex",justifyContent:"space-between"},children:[e.jsxs("span",{children:["üé≤ ",s.diceNotation]}),e.jsxs("span",{children:["Resultado: ",s.result]}),e.jsxs("span",{children:["DC: ",s.difficulty]})]}),e.jsx("style",{children:`
        @keyframes blink {
          0%, 50% { opacity: 1; }
          51%, 100% { opacity: 0; }
        }
      `})]})},ae=({diceRequests:s,characterName:S,onAllRollsComplete:x,autoRoll:f=!1})=>{const[u,k]=d.useState(0),[N,I]=d.useState(!1),[A,y]=d.useState([]),[c,l]=d.useState(null),[b,w]=d.useState(!1);d.useEffect(()=>{if(f&&s.length>0&&u<s.length){const t=setTimeout(()=>{o()},1e3);return()=>clearTimeout(t)}},[u,f,s]);const i=t=>{const n=t.match(/(\d*)d(\d+)([+-]\d+)?/i);if(!n)return{count:1,sides:20,modifier:0};const C=parseInt(n[1])||1,D=parseInt(n[2]),z=n[3]?parseInt(n[3]):0;return{count:C,sides:D,modifier:z}},g=(t,n=1)=>{const C=[];for(let D=0;D<n;D++)C.push(Math.floor(Math.random()*t)+1);return C},o=()=>{if(u>=s.length)return;const t=s[u],{count:n,sides:C,modifier:D}=i(t.diceNotation||"1d20");I(!0),setTimeout(()=>{const z=g(C,n),V=z.reduce((m,X)=>m+X,0),P=V+D,Y=t.difficulty||15,W=C===20?z[0]:0,a=W===20,j=W===1,v=a||!j&&P>=Y,M={request:t,roll:V,modifier:D,total:P,success:v,criticalSuccess:a,criticalFailure:j};l(M),y(m=>[...m,M]),I(!1),w(!0)},2500)},R=()=>{w(!1),l(null);const t=u+1;k(t),t>=s.length&&(x==null||x(A))},E=()=>{!N&&u<s.length&&o()};if(s.length===0)return null;const T=s[u],{count:B,sides:F,modifier:$}=T?i(T.diceNotation||"1d20"):{count:1,sides:20,modifier:0};return e.jsxs("div",{className:"interactive-dice-roller",style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"20px",padding:"20px",backgroundColor:"#0f172a",borderRadius:"12px",margin:"20px 0"},children:[e.jsxs("div",{className:"roller-header",style:{textAlign:"center",color:"#f1f5f9"},children:[e.jsx("h3",{style:{margin:0,marginBottom:"8px",color:"#fbbf24"},children:"üé≤ Tiradas de Dados Requeridas"}),e.jsxs("p",{style:{margin:0,color:"#94a3b8",fontSize:"14px"},children:[u+1," de ",s.length," tiradas"]})]}),T&&e.jsxs("div",{className:"current-request",style:{textAlign:"center",padding:"12px 16px",backgroundColor:"#1e293b",borderRadius:"8px",border:"1px solid #334155"},children:[e.jsx("div",{style:{color:"#f1f5f9",fontWeight:"bold",marginBottom:"4px"},children:T.description}),e.jsxs("div",{style:{color:"#94a3b8",fontSize:"12px"},children:[T.diceNotation||"1d20"," ‚Ä¢ DC ",T.difficulty||15]})]}),T&&e.jsx(Q,{diceType:F,isRolling:N,finalValue:c==null?void 0:c.roll,modifier:$,count:B,onRollComplete:()=>{}}),!f&&u<s.length&&e.jsx("button",{onClick:E,disabled:N,style:{padding:"12px 24px",backgroundColor:N?"#374151":"#3b82f6",color:"white",border:"none",borderRadius:"8px",fontSize:"16px",fontWeight:"bold",cursor:N?"not-allowed":"pointer",transition:"all 0.3s ease"},children:N?"üé≤ Rodando...":"üé≤ Tirar Dados"}),b&&c&&e.jsx(K,{roll:{type:c.request.type,ability:c.request.ability,skill:c.request.skill,difficulty:c.request.difficulty||15,description:c.request.description,diceNotation:c.request.diceNotation||"1d20",result:c.total,success:c.success,criticalSuccess:c.criticalSuccess,criticalFailure:c.criticalFailure},characterName:S,onNarrationComplete:R}),e.jsx("div",{className:"progress-indicator",style:{display:"flex",gap:"4px",alignItems:"center"},children:s.map((t,n)=>e.jsx("div",{style:{width:"12px",height:"12px",borderRadius:"50%",backgroundColor:n<u?"#10b981":n===u?"#fbbf24":"#374151",transition:"all 0.3s ease"}},n))}),A.length>0&&e.jsxs("div",{className:"results-summary",style:{marginTop:"16px",padding:"12px",backgroundColor:"#1e293b",borderRadius:"8px",width:"100%",maxWidth:"400px"},children:[e.jsx("div",{style:{color:"#fbbf24",fontWeight:"bold",marginBottom:"8px"},children:"üìä Resumen de Tiradas"}),A.map((t,n)=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"4px 0",color:"#f1f5f9",fontSize:"14px",borderBottom:n<A.length-1?"1px solid #374151":"none"},children:[e.jsx("span",{children:t.request.description}),e.jsxs("span",{style:{color:t.success?"#10b981":"#ef4444",fontWeight:"bold"},children:[t.total," ",t.success?"‚úÖ":"‚ùå"]})]},n))]})]})},ie=({option:s,index:S,characterName:x,onOptionSelect:f,disabled:u=!1})=>{var B,F,$;const[k,N]=d.useState(!1),[I,A]=d.useState(!1),[y,c]=d.useState(null),[l,b]=d.useState(!1),w=t=>{const n=t.match(/(\d*)d(\d+)([+-]\d+)?/i);if(!n)return{count:1,sides:20,modifier:0};const C=parseInt(n[1])||1,D=parseInt(n[2]),z=n[3]?parseInt(n[3]):0;return{count:C,sides:D,modifier:z}},i=(t,n=1)=>{const C=[];for(let D=0;D<n;D++)C.push(Math.floor(Math.random()*t)+1);return C},g=()=>{if(!u){if(!s.diceRequirement){f(S);return}N(!0),A(!0)}},o=()=>{if(!s.diceRequirement)return;const{count:t,sides:n,modifier:C}=w(s.diceRequirement.diceNotation),D=i(n,t),z=D.reduce((M,m)=>M+m,0),V=z+C,P=s.diceRequirement.difficulty,Y=n===20?D[0]:0,W=Y===20,a=Y===1,j=W||!a&&V>=P;c({roll:z,modifier:C,total:V,success:j,criticalSuccess:W,criticalFailure:a}),A(!1),b(!0)},R=()=>{b(!1),f(S,y||void 0)},E=t=>t<=10?"#10b981":t<=15?"#fbbf24":t<=20?"#f97316":"#ef4444",T=t=>t<=10?"F√°cil":t<=15?"Medio":t<=20?"Dif√≠cil":"Muy dif√≠cil";if(k){const{count:t,sides:n,modifier:C}=w(((B=s.diceRequirement)==null?void 0:B.diceNotation)||"1d20");return e.jsxs("div",{className:"story-option-dice-container",style:{backgroundColor:"#1e293b",border:"2px solid #3b82f6",borderRadius:"12px",padding:"20px",margin:"10px 0",textAlign:"center"},children:[e.jsx("div",{style:{color:"#f1f5f9",marginBottom:"16px",fontSize:"16px",fontWeight:"bold"},children:s.text}),e.jsxs("div",{style:{color:"#94a3b8",fontSize:"14px",marginBottom:"20px"},children:[(F=s.diceRequirement)==null?void 0:F.description," ‚Ä¢ DC ",($=s.diceRequirement)==null?void 0:$.difficulty]}),e.jsx(Q,{diceType:n,isRolling:I,finalValue:y==null?void 0:y.roll,modifier:C,onRollComplete:o,count:t}),l&&y&&s.diceRequirement&&e.jsx(K,{roll:{type:s.diceRequirement.type,ability:s.diceRequirement.ability,skill:s.diceRequirement.skill,difficulty:s.diceRequirement.difficulty,description:s.diceRequirement.description,diceNotation:s.diceRequirement.diceNotation,result:y.total,success:y.success,criticalSuccess:y.criticalSuccess,criticalFailure:y.criticalFailure},characterName:x,onNarrationComplete:R})]})}return e.jsxs("button",{className:"story-option-button",onClick:g,disabled:u,style:{width:"100%",padding:"16px",margin:"8px 0",backgroundColor:u?"#374151":"#1e293b",border:s.diceRequirement?"2px solid #3b82f6":"2px solid #6b7280",borderRadius:"8px",color:"#f1f5f9",fontSize:"14px",cursor:u?"not-allowed":"pointer",transition:"all 0.3s ease",textAlign:"left",position:"relative",overflow:"hidden"},onMouseEnter:t=>{u||(t.currentTarget.style.backgroundColor="#334155",t.currentTarget.style.transform="translateY(-2px)",t.currentTarget.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.3)")},onMouseLeave:t=>{u||(t.currentTarget.style.backgroundColor="#1e293b",t.currentTarget.style.transform="translateY(0)",t.currentTarget.style.boxShadow="none")},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:"4px"},children:[S+1,". ",s.text]}),s.diceRequirement&&e.jsxs("div",{style:{fontSize:"12px",color:"#94a3b8",display:"flex",gap:"12px",marginTop:"8px"},children:[e.jsxs("span",{children:["üé≤ ",s.diceRequirement.diceNotation]}),e.jsxs("span",{children:["üìã ",s.diceRequirement.description]}),e.jsxs("span",{style:{color:E(s.diceRequirement.difficulty)},children:["üéØ DC ",s.diceRequirement.difficulty," (",T(s.diceRequirement.difficulty),")"]})]})]}),s.diceRequirement&&e.jsxs("div",{style:{marginLeft:"12px",display:"flex",flexDirection:"column",alignItems:"center",gap:"4px"},children:[e.jsx("div",{style:{fontSize:"20px"},children:"üé≤"}),e.jsxs("div",{style:{fontSize:"10px",color:"#94a3b8",textAlign:"center"},children:["Click para",e.jsx("br",{}),"tirar dados"]})]})]}),s.diceRequirement&&e.jsx("div",{style:{position:"absolute",top:0,left:0,width:"4px",height:"100%",backgroundColor:E(s.diceRequirement.difficulty),borderRadius:"8px 0 0 8px"}})]})},ce=()=>{const[s,S]=d.useState([]),[x,f]=d.useState([]),[u,k]=d.useState([]),[N,I]=d.useState(!1),[A,y]=d.useState(""),[c,l]=d.useState(""),[b,w]=d.useState("list"),[i,g]=d.useState(null),[o,R]=d.useState(""),[E,T]=d.useState(""),[B,F]=d.useState("rapido"),[$,t]=d.useState(null),[n,C]=d.useState([]),[D,z]=d.useState(!1),[V,P]=d.useState("");d.useEffect(()=>{Y(),W()},[]);const Y=async()=>{try{const p=(await ee.getCharacters()).filter(h=>h.isAlive);S(p)}catch{y("Error al cargar personajes")}},W=async()=>{try{const r=await G.getStories();f(r)}catch(r){y("No se pudieron cargar las historias. Aseg√∫rate de que el servicio de IA est√© configurado en el servidor."),console.log("Could not load stories:",r)}},a=async()=>{if(u.length===0){y("Por favor selecciona al menos un personaje");return}I(!0),y(""),l("");try{const r={characterIds:u,theme:E.trim()||void 0,pacing:B},p=await G.createStory(r);f(L=>[p,...L]),g(p),w("play"),l("¬°Historia creada exitosamente!");const h=p.chapters[p.currentChapterIndex];if(h!=null&&h.diceRequests&&h.diceRequests.length>0){const L=s.filter(H=>u.includes(H.id)).map(H=>H.name);C(h.diceRequests),P(L[0]||"Aventurero"),z(!0)}}catch(r){y(r instanceof Error?r.message:"Error al crear la historia")}finally{I(!1)}},j=r=>{const p=r.map(h=>({roll:h.roll,modifier:h.modifier,total:h.total,success:h.success,description:h.request.description}));t(p),z(!1),C([]),console.log("Resultados de dados:",p)},v=async r=>{if(!i)return;if(!(r||o.trim())){y("Por favor selecciona una opci√≥n o ingresa una acci√≥n personalizada");return}I(!0),y("");try{const h={storyId:i.id,selectedOption:r,customAction:r?void 0:o.trim(),pacing:B},L=await G.continueStory(h);g(L),R(""),f(_=>_.map(O=>O.id===L.id?L:O));const H=L.chapters[L.currentChapterIndex];if(H!=null&&H.diceRequests&&H.diceRequests.length>0){const _=s.filter(O=>i.characterIds.includes(O.id)).map(O=>O.name);C(H.diceRequests),P(_[0]||"Aventurero"),z(!0)}}catch(h){y(h instanceof Error?h.message:"Error al continuar la historia")}finally{I(!1)}},M=r=>{t(r)},m=()=>e.jsxs("div",{className:"card",children:[e.jsx("h2",{children:"üìñ Crear Nueva Aventura"}),e.jsx("p",{children:"Selecciona personajes para comenzar una nueva historia de aventura generada por IA."}),A&&e.jsx("div",{className:"error",children:A}),c&&e.jsx("div",{className:"success",children:c}),s.length===0?e.jsx("div",{className:"error",children:"No hay personajes vivos disponibles. ¬°Crea algunos personajes primero!"}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsx("h3",{children:"Selecciona Personajes para la Aventura:"}),e.jsx("div",{className:"character-grid",children:s.map(r=>e.jsxs("div",{className:`character-card ${u.includes(r.id)?"selected":""}`,onClick:()=>{k(p=>p.includes(r.id)?p.filter(h=>h!==r.id):[...p,r.id])},style:{cursor:"pointer",border:u.includes(r.id)?"2px solid #ffd700":"1px solid rgba(255, 255, 255, 0.2)"},children:[e.jsx("div",{className:"character-name",children:r.name}),e.jsx("div",{className:"character-class",children:r.characterClass}),e.jsxs("div",{className:"stat-row",children:[e.jsxs("span",{children:["Nivel ",r.level]}),e.jsxs("span",{children:[r.hitPoints.current,"/",r.hitPoints.max," HP"]})]})]},r.id))})]}),e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsx("h3",{children:"Personaliza tu Aventura:"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"storyTheme",children:"Tema de la Historia (opcional):"}),e.jsx("input",{type:"text",id:"storyTheme",value:E,onChange:r=>T(r.target.value),placeholder:"Ej: aventura en una mazmorra antigua, rescate de un pueblo, b√∫squeda de un tesoro...",disabled:N,style:{width:"100%",padding:"10px",borderRadius:"6px",background:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.3)",color:"white"}})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"pacing",children:"Ritmo de la Historia:"}),e.jsxs("select",{id:"pacing",value:B,onChange:r=>F(r.target.value),disabled:N,style:{width:"100%",padding:"10px",borderRadius:"6px",background:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.3)",color:"white"},children:[e.jsx("option",{value:"rapido",children:"‚ö° R√°pido - Acci√≥n directa, textos concisos"}),e.jsx("option",{value:"detallado",children:"üìö Detallado - M√°s atm√≥sfera y descripci√≥n"})]})]})]}),e.jsxs("div",{style:{display:"flex",gap:"10px"},children:[e.jsx("button",{className:"button",onClick:a,disabled:N||u.length===0,children:N?"Generando...":"üé≠ Iniciar Aventura"}),e.jsx("button",{className:"button secondary",onClick:()=>{k([]),T(""),F("rapido")},disabled:N,children:"Limpiar Todo"})]})]})]}),X=()=>e.jsxs("div",{children:[e.jsxs("div",{className:"card",children:[e.jsx("h2",{children:"üìö Historias de Aventura"}),e.jsx("p",{children:"Administra tus historias de aventura generadas por IA."}),e.jsxs("div",{style:{display:"flex",gap:"10px",marginTop:"15px"},children:[e.jsx("button",{className:"button",onClick:()=>w("create"),children:"‚ûï Nueva Aventura"}),e.jsx("button",{className:"button secondary",onClick:W,children:"üîÑ Actualizar"})]})]}),x.length===0?e.jsx("div",{className:"card",children:e.jsx("p",{children:"A√∫n no hay historias. ¬°Crea tu primera aventura!"})}):e.jsx("div",{className:"character-grid",children:x.map(r=>e.jsxs("div",{className:"character-card",children:[e.jsx("div",{className:"character-name",children:r.title}),e.jsxs("div",{className:"stat-row",children:[e.jsxs("span",{children:["Cap√≠tulos: ",r.chapterCount]}),e.jsx("span",{children:r.isActive?"üü¢ Activa":"üî¥ Terminada"})]}),e.jsxs("div",{className:"stat-row",children:[e.jsxs("span",{children:["Personajes: ",r.characterIds.length]}),e.jsxs("span",{children:["Creada: ",new Date(r.createdAt).toLocaleDateString()]})]}),e.jsx("div",{style:{marginTop:"15px",display:"flex",gap:"10px"},children:e.jsx("button",{className:"button",onClick:()=>{g(r),w("play")},children:r.canContinue?"‚ñ∂Ô∏è Continuar":"üìñ Leer"})})]},r.id))})]}),q=()=>{if(!i)return null;const r=i.chapters[i.currentChapterIndex];return e.jsxs("div",{children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[e.jsxs("h2",{children:["üìñ ",i.title]}),e.jsx("button",{className:"button secondary",onClick:()=>w("list"),children:"‚Üê Volver a Historias"})]}),e.jsxs("div",{className:"stat-row",children:[e.jsxs("span",{children:["Cap√≠tulo ",i.currentChapterIndex+1," de ",i.chapterCount]}),e.jsx("span",{children:i.isActive?"üü¢ Activa":"üî¥ Completa"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{style:{fontSize:"1.1rem",lineHeight:"1.6",marginBottom:"20px",whiteSpace:"pre-wrap"},children:r==null?void 0:r.content}),(r==null?void 0:r.metadata)&&e.jsxs("div",{style:{fontSize:"0.8rem",opacity:.7,borderTop:"1px solid rgba(255,255,255,0.2)",paddingTop:"10px"},children:["Generado en ",r.metadata.generationTime,"ms"]})]}),i.canContinue&&e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"¬øQu√© haces a continuaci√≥n?"}),e.jsxs("div",{className:"form-group",style:{marginBottom:"20px"},children:[e.jsx("label",{htmlFor:"gamePacing",children:"Ritmo para las siguientes respuestas:"}),e.jsxs("select",{id:"gamePacing",value:B,onChange:p=>F(p.target.value),disabled:N,style:{width:"100%",padding:"8px",borderRadius:"6px",background:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.3)",color:"white",fontSize:"0.9rem"},children:[e.jsx("option",{value:"rapido",children:"‚ö° R√°pido - Respuestas concisas"}),e.jsx("option",{value:"detallado",children:"üìö Detallado - M√°s descripci√≥n"})]})]}),A&&e.jsx("div",{className:"error",children:A}),D&&n.length>0&&e.jsx(ae,{diceRequests:n,characterName:V,onAllRollsComplete:j,autoRoll:!0}),!D&&(r==null?void 0:r.diceRequests)&&r.diceRequests.length>0&&!$&&e.jsx(re,{diceRequests:r.diceRequests,onRollComplete:M}),$&&e.jsxs("div",{className:"card",style:{marginBottom:"20px",background:"rgba(0, 184, 148, 0.2)"},children:[e.jsx("h3",{children:"üé≤ Resultados de las Tiradas"}),$.map((p,h)=>e.jsxs("div",{style:{padding:"10px",marginBottom:"10px",background:"rgba(255, 255, 255, 0.1)",borderRadius:"6px"},children:[e.jsx("strong",{children:p.description}),": ",p.total,p.success!==void 0&&e.jsx("span",{style:{marginLeft:"10px",color:p.success?"#00b894":"#ff6b6b",fontWeight:"bold"},children:p.success?"‚úÖ √âxito":"‚ùå Fallo"})]},h)),e.jsx("button",{className:"button secondary",onClick:()=>t(null),style:{marginTop:"10px"},children:"Cerrar Resultados"})]}),(r==null?void 0:r.options)&&r.options.length>0&&e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsx("h4",{children:"Elige una acci√≥n:"}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px",marginTop:"10px"},children:r.options.map((p,h)=>{var _;const L={text:p,diceRequirement:(_=r.diceRequests)!=null&&_[h]?{type:r.diceRequests[h].type,ability:r.diceRequests[h].ability,skill:r.diceRequests[h].skill,difficulty:r.diceRequests[h].difficulty||15,description:r.diceRequests[h].description,diceNotation:r.diceRequests[h].diceNotation||"1d20"}:void 0},H=s.filter(O=>i==null?void 0:i.characterIds.includes(O.id)).map(O=>O.name)[0]||"Aventurero";return e.jsx(ie,{option:L,index:h,characterName:H,onOptionSelect:(O,J)=>{const U=r.options[O];J&&console.log("Opci√≥n con resultado de dados:",U,J),v(U)},disabled:N},h)})})]}),e.jsxs("div",{children:[e.jsx("h4",{children:"O ingresa tu propia acci√≥n:"}),e.jsx("div",{className:"form-group",children:e.jsx("textarea",{value:o,onChange:p=>R(p.target.value),placeholder:"Describe lo que hace tu grupo...",rows:3,disabled:N,style:{width:"100%",padding:"10px",borderRadius:"6px",background:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.3)",color:"white",resize:"vertical"}})}),e.jsx("button",{className:"button",onClick:()=>v(),disabled:N||!o.trim(),children:N?"Generando...":"‚ú® Continuar con Acci√≥n Personalizada"})]})]}),i.chapters.length>1&&e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"üìú Historial de la Historia"}),e.jsx("div",{style:{maxHeight:"300px",overflowY:"auto"},children:i.chapters.slice(0,-1).map((p,h)=>e.jsxs("div",{style:{marginBottom:"15px",paddingBottom:"15px",borderBottom:"1px solid rgba(255,255,255,0.1)"},children:[e.jsxs("div",{style:{fontSize:"0.9rem",opacity:.8,marginBottom:"5px"},children:["Cap√≠tulo ",h+1," ",p.playerAction&&`- Acci√≥n: "${p.playerAction}"`]}),e.jsx("div",{style:{fontSize:"0.95rem",lineHeight:"1.5"},children:p.content.length>200?`${p.content.substring(0,200)}...`:p.content})]},p.id))})]})]})},Z=()=>{switch(b){case"create":return m();case"play":return q();case"list":default:return X()}};return e.jsxs("div",{children:[e.jsxs("div",{className:"card",style:{marginBottom:"20px",textAlign:"center"},children:[e.jsx("h1",{style:{color:"#fbbf24",marginBottom:"10px"},children:"üêâ Aventuras de Calabozos y Dragones"}),e.jsx("p",{style:{opacity:.9},children:"Crea y vive aventuras √©picas generadas por IA con dados 3D realistas"}),e.jsxs("div",{style:{display:"flex",gap:"10px",justifyContent:"center",marginTop:"15px"},children:[e.jsx("button",{className:`button ${b==="list"?"":"secondary"}`,onClick:()=>w("list"),children:"üìö Mis Historias"}),e.jsx("button",{className:`button ${b==="create"?"":"secondary"}`,onClick:()=>w("create"),children:"‚ûï Nueva Aventura"})]})]}),Z()]})};export{ce as StoryMode};
